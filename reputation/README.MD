# Модуль репутации

Задумывался как удерживающий фактор игроков на сервере. В теории, чем больше репа у игрока, тем сложнее ему отказаться от игры на сервере (привязанность). Также репутация должна была выступать гарантом человека в различных сделках. Ну и как краткая характеристика незнакомца

#### Окошко изменения репутации (в комплекте)
![](https://img.qweqwe.ovh/1597506730395.jpg)

#### Просмотр репутации игрока
![](https://img.qweqwe.ovh/1597507053207.jpg)

## Зависимости
- SQL БД (mysql, mariadb..)
- dash либа САП'a (как минимум mysql, cmd и nw)
- ui либа от слитого САПа (да простит меня пингвин. Она реально хороша)
- Инклюд файлов шел автоматически через загрузчик модулей тригона (разберетесь)
- Возможно, что-то еще. Смотрите по ошибкам

## Интеграции

#### Вот так выглядела моя интеграция с TAB (DIY)
![](https://img.qweqwe.ovh/1597506681778.jpg)
Чем лучше репа, тем зеленее цвет. При негативной она краснела

### Модерация новой репы через Telegram
![](https://img.qweqwe.ovh/1597508013948.jpg)

#### Вот так у игроков над головой (DIY)
![](https://img.qweqwe.ovh/1597507487092.jpg)
```lua
putText("Репутация: " .. REP.getWeight(pl), REP.getWeightColor(pl))
```

#### А также:
- При написании "спс", "спасибо" и подобного вылезало предложение изменить репу
- В TAB при клике на игрока появлялись кнопки "Изменить репутацию" и "Посмотреть репутацию"
- Репутацию можно было оставлять с 1 ЛВЛ
- Вместе с репутацией у игрока повышалась карма
- Донат на колу разработчику или на продление хостинга давало репу
- Счетчик изменений репутаций за сутки отображался в статусе ВК группы
- ПКМ на игрока в контекстное меню добавляло кнопки управления репой:
```lua
properties.Add("rep_add",{
	MenuLabel = "Изменить репутацию",
	Order = 25,
	MenuIcon = "icon16/heart_add.png",

	Filter = function(self,ent,ply)
		return IsValid(ent) && ent:IsPlayer()
	end,
	Action = function(self,ent)
		REP.VGUI_MakeReview(ent)
	end
})

properties.Add("rep_inf",{
	MenuLabel = "Посмотреть репу",
	Order = 25,
	MenuIcon = "icon16/folder_heart.png",

	Filter = function(self,ent,ply)
		return IsValid(ent) && ent:IsPlayer()
	end,
	Action = function(self,ent)
		cmd.Run("rep", ent:SteamID())
	end
})
```

## Проблемы
- Неграмотное хранение кеша репутаций на сервере (в самой ОЗУ. REP.IDMAP, REP.SIDMAP)
- Причина отказа - нежелание поддерживать код. Хотя он в меру хороший. Может быть, когда-то это заменится на "Отзывы об игроках"
